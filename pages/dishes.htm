title = "Dishes"
url = "/dishes"
layout = "default"
==
<?php
function onStart()
{
    $this['currentPage'] = 'dish';
    $this['dishes'] = Plugins\Responsiv\DishSmith\Models\Dish::ofUser(Auth::getUser())->get();
}

function onSaveDish()
{

}

function onNewDish() {}

function onAddIngredient()
{
    $ingredients = [];
    $ingredientsRaw = post('ingredients');
    if (isset($ingredientsRaw['name'])) {
        foreach ($ingredientsRaw['name'] as $key => $value) {
            $ingredients[] = [
                'name' => $value,
                'type' => $ingredientsRaw['type'][$key],
                'amount' => $ingredientsRaw['amount'][$key]
            ];
        }
    }

    $ingredients[] = [
        'name' => post('ingredient'),
        'type' => post('type'),
        'amount' => post('amount'),
    ];

    $this['ingredients'] = $ingredients;
    $this['dishName'] = post('name');
}
?>
==
{% put scripts %}
<script>
    $(document).on('keyup', '#inputDishName', function(){
        var name = $(this).val()
        if (!name) 
            $('#previewDishName').html('<span class="text-muted">No name</span>')
        else
            $('#previewDishName').text(name)
    })

    function clearIngredientsForm() {
        $('#inputIngredientAmount, #inputIngredientName').val('')
        $('#inputIngredientAmount').focus()
    }
</script>
{% endput %}
<div class="dishes-page" id="dishesPage">

    <div class="dishes">

        <div
            class="col-xs-12 col-sm-12 col-md-6 col-lg-4">
            <a
                href="javascript:;" 
                class="new-dish" 
                data-request="onNewDish"
                data-request-success="$('#dishesPage').toggleClass('edit-mode')"
                data-request-update="'dishes/form': '#partialDishesForm'">
                <i class="icon-plus"></i>
                <p>New dish</p>
            </a>
        </div>

        {% for dish in dishes %}
            {% partial 'dishes/dish' dish=dish %}
        {% endfor %}

    </div>

    <!-- Form -->
    <div class="row dish-form" id="partialDishesForm">
        {% partial 'dishes/form' %}
    </div>

</div>
